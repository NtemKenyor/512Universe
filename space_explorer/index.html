<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Adventure Game</title>
    <link rel="icon" href="../logo.png" type="image/png">
    
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Arial', sans-serif;
        }

        /* Starry background */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0;
            animation: twinkle 1.5s infinite;
        }

        @keyframes twinkle {
            0%, 20%, 80%, 100% { opacity: 0; }
            10%, 30%, 50%, 70% { opacity: 1; }
        }

        canvas {
            display: block;
            margin: 20px auto;
            border: 3px solid rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            background: rgba(0, 0, 0, 0.8);
        }

        #scoreDisplay, #timerDisplay, #levelDisplay {
            color: white;
            text-align: center;
            font-size: 24px;
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.7);
            margin: 5px 0;
        }

        #gameInfo {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 16px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
        }
        
        /* Game Over Popup */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .popup-content {
            text-align: center;
            background: rgba(0, 0, 30, 0.9);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #4a90e2;
            box-shadow: 0 0 30px rgba(74, 144, 226, 0.5);
            max-width: 400px;
            width: 80%;
        }

        .popup-title {
            color: #4a90e2;
            font-size: 28px;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(74, 144, 226, 0.7);
        }

        .popup-message {
            color: white;
            font-size: 18px;
            margin-bottom: 25px;
        }

        .popup-score {
            color: #ffcc00;
            font-size: 22px;
            margin-bottom: 25px;
            font-weight: bold;
        }

        .game-button {
            font-size: 20px;
            padding: 12px 25px;
            color: white;
            background: linear-gradient(45deg, #4a90e2, #6a5acd);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .game-button:hover {
            transform: scale(1.05);
            background: linear-gradient(45deg, #6a5acd, #4a90e2);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.5);
        }

        .game-button:active {
            transform: scale(0.98);
        }

        /* Start Game Popup */
        #gameStartPopup {
            display: flex;
        }

        .startGameButton {
            font-size: 24px;
            padding: 15px 40px;
            color: white;
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .startGameButton:hover {
            background: linear-gradient(45deg, #ff4b2b, #ff416c);
        }

        /* Controls Info */
        #controlsInfo {
            margin-top: 20px;
            color: #aaa;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="stars"></div>
    <div id="gameInfo">
        <div id="scoreDisplay">Score: 0</div>
        <div id="timerDisplay">Time: 30</div>
        <div id="levelDisplay">Level: 1</div>
    </div>
    <canvas id="gameCanvas" width="400" height="600"></canvas>
    
    <!-- Audio elements -->
    <audio id="backgroundMusic" loop>
        <source src="music.mp3" type="audio/mpeg">
    </audio>
    <audio id="startSound">
        <source src="effects.wav" type="audio/mpeg">
    </audio>
    <audio id="gameOverSound">
        <source src="gameover.wav" type="audio/mpeg">
    </audio>
    <audio id="explosionSound">
        <source src="explosion.wav" type="audio/mpeg">
    </audio>

    <!-- Start Game Popup -->
    <div id="gameStartPopup" class="popup-overlay">
        <div class="popup-content">
            <h1 class="popup-title">Space Adventure</h1>
            <p class="popup-message">Defend your ship from incoming asteroids!</p>
            <div id="controlsInfo">
                <p>Controls: Arrow keys to move, Space to shoot</p>
            </div>
            <button id="startGameButton" class="startGameButton" onclick="startGame()">Start Game</button>
        </div>
    </div>

    <!-- Game Over Popup -->
    <div id="gameOverPopup" class="popup-overlay">
        <div class="popup-content">
            <h1 class="popup-title">Game Over</h1>
            <p class="popup-message">Your spaceship was destroyed!</p>
            <div class="popup-score">Final Score: <span id="finalScore">0</span></div>
            <div>
                <button class="game-button" onclick="resetGame()">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        // Game variables
        let canvas, ctx;
        let ship = {
            x: 200,
            y: 550,
            width: 40,
            height: 40,
            speed: 5,
            color: '#4a90e2'
        };
        
        let bullets = [];
        let asteroids = [];
        let score = 0;
        let timeLeft = 30;
        let level = 1;
        let gameInterval;
        let timerInterval;
        let gameActive = false;
        let asteroidSpeed = 2;
        let asteroidSpawnRate = 60; // frames
        let frameCount = 0;

        // Initialize game when window loads
        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // Create stars in the background
            createStars();
            
            // Set up event listeners
            document.addEventListener('keydown', handleKeyPress);
            
            // Draw initial game state
            drawGame();
        };

        // Create starry background
        function createStars() {
            const starField = document.querySelector('.stars');
            const numberOfStars = 150;
            
            for (let i = 0; i < numberOfStars; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 3 + 1;
                const posX = Math.random() * window.innerWidth;
                const posY = Math.random() * window.innerHeight;
                const animationDuration = Math.random() * 2 + 1;
                
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${posX}px`;
                star.style.top = `${posY}px`;
                star.style.animationDuration = `${animationDuration}s`;
                star.style.animationDelay = `${Math.random() * 2}s`;
                
                starField.appendChild(star);
            }
        }

        // Start the game
        function startGame() {
            document.getElementById('gameStartPopup').style.display = 'none';
            document.getElementById('backgroundMusic').play();
            document.getElementById('startSound').play();
            
            resetGameState();
            gameActive = true;
            
            // Start game loop
            gameInterval = setInterval(updateGame, 20);
            
            // Start timer
            timerInterval = setInterval(function() {
                timeLeft--;
                document.getElementById('timerDisplay').textContent = `Time: ${timeLeft}`;
                
                if (timeLeft <= 0) {
                    endGame(true); // Player wins
                }
            }, 1000);
        }

        // Reset game state
        function resetGameState() {
            ship.x = 200;
            ship.y = 550;
            bullets = [];
            asteroids = [];
            score = 0;
            timeLeft = 30;
            level = 1;
            asteroidSpeed = 2;
            asteroidSpawnRate = 60;
            frameCount = 0;
            
            document.getElementById('scoreDisplay').textContent = `Score: ${score}`;
            document.getElementById('timerDisplay').textContent = `Time: ${timeLeft}`;
            document.getElementById('levelDisplay').textContent = `Level: ${level}`;
        }

        // Reset and restart game
        function resetGame() {
            document.getElementById('gameOverPopup').style.display = 'none';
            document.getElementById('backgroundMusic').currentTime = 0;
            document.getElementById('backgroundMusic').play();
            startGame();
        }

        // End the game
        function endGame(win = false) {
            gameActive = false;
            clearInterval(gameInterval);
            clearInterval(timerInterval);
            
            document.getElementById('backgroundMusic').pause();
            document.getElementById('gameOverSound').play();
            
            document.getElementById('finalScore').textContent = score;
            
            if (win) {
                document.querySelector('#gameOverPopup .popup-title').textContent = 'Mission Complete!';
                document.querySelector('#gameOverPopup .popup-message').textContent = 'You successfully defended your ship!';
            } else {
                document.querySelector('#gameOverPopup .popup-title').textContent = 'Game Over';
                document.querySelector('#gameOverPopup .popup-message').textContent = 'Your spaceship was destroyed!';
            }
            
            document.getElementById('gameOverPopup').style.display = 'flex';
        }

        // Main game update loop
        function updateGame() {
            // Move bullets
            for (let i = bullets.length - 1; i >= 0; i--) {
                bullets[i].y -= bullets[i].speed;
                
                // Remove bullets that go off screen
                if (bullets[i].y < 0) {
                    bullets.splice(i, 1);
                }
            }
            
            // Spawn new asteroids
            frameCount++;
            if (frameCount % asteroidSpawnRate === 0) {
                createAsteroid();
                
                // Increase difficulty over time
                if (frameCount % 600 === 0) { // Every ~12 seconds
                    level++;
                    asteroidSpeed += 0.5;
                    asteroidSpawnRate = Math.max(20, asteroidSpawnRate - 5);
                    document.getElementById('levelDisplay').textContent = `Level: ${level}`;
                }
            }
            
            // Move asteroids and check collisions
            for (let i = asteroids.length - 1; i >= 0; i--) {
                asteroids[i].y += asteroids[i].speed;
                
                // Check if asteroid hits the ship
                if (checkCollision(ship, asteroids[i])) {
                    document.getElementById('explosionSound').play();
                    endGame();
                    return;
                }
                
                // Check if asteroid goes off screen
                if (asteroids[i].y > canvas.height) {
                    asteroids.splice(i, 1);
                    continue;
                }
                
                // Check bullet collisions
                for (let j = bullets.length - 1; j >= 0; j--) {
                    if (checkCollision(bullets[j], asteroids[i])) {
                        document.getElementById('explosionSound').play();
                        bullets.splice(j, 1);
                        asteroids.splice(i, 1);
                        score += 10;
                        document.getElementById('scoreDisplay').textContent = `Score: ${score}`;
                        break;
                    }
                }
            }
            
            drawGame();
        }

        // Draw the game state
        function drawGame() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw ship
            ctx.fillStyle = ship.color;
            ctx.beginPath();
            ctx.moveTo(ship.x, ship.y - ship.height/2);
            ctx.lineTo(ship.x + ship.width/2, ship.y + ship.height/2);
            ctx.lineTo(ship.x - ship.width/2, ship.y + ship.height/2);
            ctx.closePath();
            ctx.fill();
            
            // Draw bullets
            ctx.fillStyle = '#ffcc00';
            bullets.forEach(bullet => {
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, bullet.radius, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // Draw asteroids
            ctx.fillStyle = '#888';
            asteroids.forEach(asteroid => {
                ctx.beginPath();
                ctx.arc(asteroid.x, asteroid.y, asteroid.radius, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // Create a new asteroid
        function createAsteroid() {
            const radius = Math.random() * 20 + 10;
            asteroids.push({
                x: Math.random() * (canvas.width - radius * 2) + radius,
                y: -radius,
                radius: radius,
                speed: Math.random() * asteroidSpeed + asteroidSpeed * 0.5
            });
        }

        // Check collision between two objects
        function checkCollision(obj1, obj2) {
            // If both are circular (asteroids and bullets)
            if (obj1.radius !== undefined && obj2.radius !== undefined) {
                const dx = obj1.x - obj2.x;
                const dy = obj1.y - obj2.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                return distance < obj1.radius + obj2.radius;
            }
            
            // If one is the ship (triangular) and the other is circular
            if (obj1.width !== undefined || obj2.width !== undefined) {
                const shipObj = obj1.width !== undefined ? obj1 : obj2;
                const asteroid = obj1.width !== undefined ? obj2 : obj1;
                
                // Simple distance check from ship center to asteroid center
                const dx = shipObj.x - asteroid.x;
                const dy = shipObj.y - asteroid.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                // If distance is less than asteroid radius + half ship size
                return distance < asteroid.radius + Math.max(shipObj.width, shipObj.height)/2;
            }
            
            return false;
        }

        // Handle keyboard input
        function handleKeyPress(e) {
            if (!gameActive) return;
            
            switch(e.key) {
                case 'ArrowLeft':
                    ship.x = Math.max(ship.width/2, ship.x - ship.speed);
                    break;
                case 'ArrowRight':
                    ship.x = Math.min(canvas.width - ship.width/2, ship.x + ship.speed);
                    break;
                case 'ArrowUp':
                    ship.y = Math.max(ship.height/2, ship.y - ship.speed);
                    break;
                case 'ArrowDown':
                    ship.y = Math.min(canvas.height - ship.height/2, ship.y + ship.speed);
                    break;
                case ' ':
                    // Fire bullet
                    bullets.push({
                        x: ship.x,
                        y: ship.y - ship.height/2,
                        radius: 3,
                        speed: 7
                    });
                    document.getElementById('startSound').currentTime = 0;
                    document.getElementById('startSound').play();
                    break;
            }
        }
    </script>
</body>
</html>